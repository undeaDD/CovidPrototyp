function signout(){firebase.auth().signOut()}function snapshotToArray(e){var a=[];return e.forEach(function(e){var t=e.val();t.id=e.key,a.push(t)}),a}function indexToFirebaseNames1(e){switch(parseInt(e)){case 2:return"lastname";case 3:return"firstname";case 4:return"street";case 5:return"zip";case 6:return"address";case 7:return"birthdate";case 8:return"telephone";case 9:return"mobile";case 10:return"fax";case 11:return"email";case 12:return"emailcopy";case 13:return"personalid";case 13:return"insertDate";default:alert("fatal Error")}}function indexToFirebaseNames2(e){switch(parseInt(e)){case 3:return"lname";case 4:return"fname";case 5:return"street";case 6:return"zip";case 7:return"address";case 8:return"birthday";case 9:return"telephone";case 10:return"mobile";case 11:return"fax";case 12:return"email";case 13:return"emailcopy";case 14:return"personalid";case 15:return"insertDate";case 16:return"collectionDate";case 17:return"testDate";default:alert("fatal Error")}}function updateEntry1(){const e=$("#edit1FieldHiddenKey").val(),a=$("#edit1FieldHiddenId").val().split(".")[1],t=indexToFirebaseNames1($("#edit1FieldHiddenIndex").val());firebase.database().ref("requests/"+e+"/p"+a+"_"+t).set($("#edit1Field").val())}function updateEntry2(){const e=$("#edit2FieldHiddenId").val(),a=indexToFirebaseNames2($("#edit2FieldHiddenIndex").val());firebase.database().ref("patients/"+e+"/"+a).set($("#edit2Field").val())}function approveEntry(e){firebase.database().ref("patients").once("value").then(a=>{var t=0;a.forEach(function(e){const a=parseInt(e.key.replace("C",""));0==t&&(t=a),t=t<a?a:t}),firebase.database().ref("requests/"+e).once("value").then(a=>{const r=(new Date).toLocaleDateString();var i=a.val();i.id=a.key;var d=new Object;switch(i.morepatients){case"4":d["C"+(t+5)]={poolid:"C"+(t+1),lname:i.p5_lastname,fname:i.p5_firstname,street:i.p5_street,plz:i.p5_zip,city:i.p5_address,birthday:i.p5_birthdate,tel:i.p5_telephone,mobile:i.p5_mobile,fax:i.p5_fax,email:i.p5_email,emailCopy:i.p5_emailcopy,personalid:i.p5_personalid,date1:i.insertDate,date2:r,front:i.p5_front,back:i.p5_back};case"3":d["C"+(t+4)]={poolid:"C"+(t+1),lname:i.p4_lastname,fname:i.p4_firstname,street:i.p4_street,plz:i.p4_zip,city:i.p4_address,birthday:i.p4_birthdate,tel:i.p4_telephone,mobile:i.p4_mobile,fax:i.p4_fax,email:i.p4_email,emailCopy:i.p4_emailcopy,personalid:i.p4_personalid,date1:i.insertDate,date2:r,front:i.p4_front,back:i.p4_back};case"2":d["C"+(t+3)]={poolid:"C"+(t+1),lname:i.p3_lastname,fname:i.p3_firstname,street:i.p3_street,plz:i.p3_zip,city:i.p3_address,birthday:i.p3_birthdate,tel:i.p3_telephone,mobile:i.p3_mobile,fax:i.p3_fax,email:i.p3_email,emailCopy:i.p3_emailcopy,personalid:i.p3_personalid,date1:i.insertDate,front:i.p3_front,back:i.p3_back};case"1":d["C"+(t+2)]={poolid:"C"+(t+1),lname:i.p2_lastname,fname:i.p2_firstname,street:i.p2_street,plz:i.p2_zip,city:i.p2_address,birthday:i.p2_birthdate,tel:i.p2_telephone,mobile:i.p2_mobile,fax:i.p2_fax,email:i.p2_email,emailCopy:i.p2_emailcopy,personalid:i.p2_personalid,date1:i.insertDate,date2:r,front:i.p2_front,back:i.p2_back};default:d["C"+(t+1)]={poolid:"C"+(t+1),lname:i.p1_lastname,fname:i.p1_firstname,street:i.p1_street,plz:i.p1_zip,city:i.p1_address,birthday:i.p1_birthdate,tel:i.p1_telephone,mobile:i.p1_mobile,fax:i.p1_fax,email:i.p1_email,emailCopy:i.p1_emailcopy,personalid:i.p1_personalid,date1:i.insertDate,date2:r,front:i.p1_front,back:i.p1_back,signature:i.signature}}d=JSON.parse(JSON.stringify(d)),firebase.database().ref("patients/").update(d),firebase.database().ref("requests/"+e).remove()})})}function removeEntry(e){confirm("Soll der Eintrag wirklich gelöscht werden?")&&firebase.database().ref(e).remove()}firebase.initializeApp({apiKey:"AIzaSyAKzR5AiJVZ3Iz5tJrWsLeBVDZJl2SSqLE",authDomain:"coronaprototyp.firebaseapp.com",databaseURL:"https://coronaprototyp.firebaseio.com",projectId:"coronaprototyp",storageBucket:"coronaprototyp.appspot.com",messagingSenderId:"857488715212",appId:"1:857488715212:web:763e73804d890e4bf40169"}),$(document).on("click",'[data-toggle="lightbox"]',function(e){e.preventDefault(),$(this).ekkoLightbox({alwaysShowClose:!0})}),window.addEventListener("message",function(e){"modal.close"==e.data.type&&$("#addModal").modal("hide")}),$(function(){$(window).resize(function(){$("#table1").DataTable().columns.adjust().draw(),$("#table1").DataTable().fixedHeader.adjust().draw(),$("#table2").DataTable().columns.adjust().draw(),$("#table2").DataTable().fixedHeader.adjust().draw()}),firebase.auth().onAuthStateChanged(function(e){e?(document.body.classList.remove("d-none"),firebase.database().ref("requests").on("value",function(e){var a=snapshotToArray(e),t=[],r=1;for(const e of a){var i=[];switch(e.morepatients){case"4":i.push({key:e.id,id:r+".5",lname:e.p5_lastname,fname:e.p5_firstname,street:e.p5_street,plz:e.p5_zip,city:e.p5_address,birthday:e.p5_birthdate,tel:e.p5_telephone,mobile:e.p5_mobile,fax:e.p5_fax,email:e.p5_email,emailCopy:e.p5_emailcopy,personalid:e.p5_personalid,date1:e.insertDate,front:e.p5_front,back:e.p5_back});case"3":i.push({key:e.id,id:r+".4",lname:e.p4_lastname,fname:e.p4_firstname,street:e.p4_street,plz:e.p4_zip,city:e.p4_address,birthday:e.p4_birthdate,tel:e.p4_telephone,mobile:e.p4_mobile,fax:e.p4_fax,email:e.p4_email,emailCopy:e.p4_emailcopy,personalid:e.p4_personalid,date1:e.insertDate,front:e.p4_front,back:e.p4_back});case"2":i.push({key:e.id,id:r+".3",lname:e.p3_lastname,fname:e.p3_firstname,street:e.p3_street,plz:e.p3_zip,city:e.p3_address,birthday:e.p3_birthdate,tel:e.p3_telephone,mobile:e.p3_mobile,fax:e.p3_fax,email:e.p3_email,emailCopy:e.p3_emailcopy,personalid:e.p3_personalid,date1:e.insertDate,front:e.p3_front,back:e.p3_back});case"1":i.push({key:e.id,id:r+".2",lname:e.p2_lastname,fname:e.p2_firstname,street:e.p2_street,plz:e.p2_zip,city:e.p2_address,birthday:e.p2_birthdate,tel:e.p2_telephone,mobile:e.p2_mobile,fax:e.p2_fax,email:e.p2_email,emailCopy:e.p2_emailcopy,personalid:e.p2_personalid,date1:e.insertDate,front:e.p2_front,back:e.p2_back});default:i.push({key:e.id,id:r+".1",lname:e.p1_lastname,fname:e.p1_firstname,street:e.p1_street,plz:e.p1_zip,city:e.p1_address,birthday:e.p1_birthdate,tel:e.p1_telephone,mobile:e.p1_mobile,fax:e.p1_fax,email:e.p1_email,emailCopy:e.p1_emailcopy,personalid:e.p1_personalid,date1:e.insertDate,front:e.p1_front,back:e.p1_back,signature:e.signature})}t.push(...i.reverse()),r+=1}var d=$("#table1").DataTable({dom:"<'row'<'col-6 'B><'col-6'f>><'row'<'col-sm-12'tr>>",blurable:!1,destroy:!0,paging:!1,ordering:!0,info:!1,keys:{columns:[2,3,4,5,6,7,8,9,10,11,12,13]},searching:!0,fixedHeader:!0,scrollX:!0,autoWidth:!1,language:{search:"",searchPlaceholder:"Nach Eintrag suchen",emptyTable:"Keine Einträge vorhanden"},buttons:[{text:"<img height='21' class='mr-2' style='margin-top: -4px;' src='../assets/img/file-plus.png'/>Neuer Eintrag",action:function(e,a,t,r){$("#addIFrame").prop("src","../index.html"),$("#addModal").modal({show:!0})},className:"customButton mr-2"}],createdRow:function(e,a,t){a.id.endsWith(".1")&&$(e).addClass("striped")},order:[[1,"asc"]],columns:[{data:"actions",defaultContent:"",orderable:!1,searchable:!1,render:function(e,a,t,r){return t.id.endsWith(".1")?"<a onclick='approveEntry(\""+t.key+"\")'><img height='21' class='mr-3' src='../assets/img/check-circle.png'/></a><a onclick='removeEntry(\"requests/"+t.key+"\")'><img height='21' src='../assets/img/trash.png'/></a>":""}},{data:"id",className:"bold",orderable:!0,searchable:!1},{data:"lname",orderable:!1},{data:"fname",orderable:!1},{data:"street",orderable:!1},{data:"plz",orderable:!1},{data:"city",orderable:!1},{data:"birthday",orderable:!1},{data:"tel",defaultContent:"-",orderable:!1},{data:"mobile",defaultContent:"-",orderable:!1},{data:"fax",defaultContent:"-",orderable:!1},{data:"email",defaultContent:"-",render:function(e,a,t,r){return"display"===a&&void 0!==e&&"-"!==e?'<a href="mailto:'+e+'">'+e+"</a>":e},orderable:!1},{data:"emailCopy",defaultContent:"-",render:function(e,a,t,r){return"display"===a&&void 0!==e&&"-"!==e?'<a href="mailto:'+e+'">'+e+"</a>":e},orderable:!1},{data:"personalid",defaultContent:"-",orderable:!1},{data:"date1",defaultContent:"-",orderable:!0},{data:"files",defaultContent:"-",searchable:!1,render:function(e,a,t,r){var i="";return t.signature&&(i+='<a href="'+t.signature+'" data-title="Signatur:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/signature.png"/></a>'),t.front&&(i+='<a href="'+t.front+'" data-title="Vorderseite:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/id-card.png"/></a>'),t.back&&(i+='<a href="'+t.back+'" data-title="Rückseite:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/id-card.png"/></a>'),i},orderable:!1}],data:t});d.columns.adjust().draw(),d.fixedHeader.adjust().draw(),$("#count1").text(d.data().count()),$("#edit1Modal").on("shown.bs.modal",function(){$("#edit1Field").focus()}),$("#table1").DataTable().on("dblclick","td",function(){var e=$("#table1").DataTable().row(this),a=$("#table1").DataTable().cell(this);const t=[0,1,14];t.includes(a.index().column)||($("#edit1FieldHiddenKey").val(e.data().key),$("#edit1FieldHiddenId").val(e.data().id),$("#edit1FieldHiddenIndex").val(a.index().column),$("#edit1Field").val(a.data()),$("#edit1Modal").modal({keyboard:!1,show:!0}))})}),firebase.database().ref("patients").on("value",function(e){var a=snapshotToArray(e),t=$("#table2").DataTable({dom:"<'row'<'col-6 'B><'col-6'f>><'row'<'col-sm-12'tr>>",blurable:!1,destroy:!0,paging:!1,ordering:!0,info:!1,keys:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]},searching:!0,fixedHeader:!0,scrollX:!0,autoWidth:!1,order:[[1,"desc"]],language:{search:"",searchPlaceholder:"Nach Eintrag suchen",emptyTable:"Keine Einträge vorhanden"},buttons:[{extend:"csvHtml5",charset:"UTF-8",fieldSeparator:";",bom:!0,text:"<img height='21' class='mr-2' style='margin-top: -4px;' src='../assets/img/file-export.png'/>Daten Exportieren",className:"customButton mr-2"},{text:"<img height='21' class='mr-2' style='margin-top: -4px;' src='../assets/img/file-import.png'/>Daten Importieren (Experimentell)",className:"customButton mr-2",action:function(e,a,t,r){$("#fileupload").click()}}],columns:[{data:"actions",defaultContent:"",orderable:!1,searchable:!1,render:function(e,a,t,r){return"<a href='http://www.barcode-generator.org/phpqrcode/getCode.php?cht=qr&chl="+t.id+"&chs=180x180&choe=UTF-8&chld=L|0' data-title='QR-Code:' data-toggle='lightbox' data-width=290 data-height=290 ><img height='21' class='mr-2' src='../assets/img/barcode-read.png'/></a><a onclick='removeEntry(\"patients/"+t.id+"\")'><img height='21' src='../assets/img/trash.png'/></a>"}},{data:"id",className:"bold",orderable:!0},{data:"poolid",defaultContent:"-",orderable:!1,searchable:!0},{data:"lname",orderable:!1},{data:"fname",orderable:!1},{data:"street",orderable:!1},{data:"plz",orderable:!1},{data:"city",orderable:!1},{data:"birthday",orderable:!1},{data:"tel",defaultContent:"-",orderable:!1},{data:"mobile",defaultContent:"-",orderable:!1},{data:"fax",defaultContent:"-",orderable:!1},{data:"email",defaultContent:"-",render:function(e,a,t,r){return"display"===a&&void 0!==e&&"-"!==e?'<a href="mailto:'+e+'">'+e+"</a>":e},orderable:!1},{data:"emailCopy",defaultContent:"-",render:function(e,a,t,r){return"display"===a&&void 0!==e&&"-"!==e?'<a href="mailto:'+e+'">'+e+"</a>":e},orderable:!1},{data:"idnumber",defaultContent:"-",orderable:!1},{data:"date1",defaultContent:"-",orderable:!0},{data:"date2",defaultContent:"-",orderable:!0},{data:"date3",defaultContent:"-",orderable:!0},{data:"files",defaultContent:"-",render:function(e,a,t,r){var i="";return t.signature&&(i+='<a href="'+t.signature+'" data-title="Signatur:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/signature.png"/></a>'),t.front&&(i+='<a href="'+t.front+'" data-title="Vorderseite:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/id-card.png"/></a>'),t.back&&(i+='<a href="'+t.back+'" data-title="Rückseite:" data-toggle="lightbox" class="mx-1"><img height="21" src="../assets/img/id-card.png"/></a>'),i},orderable:!1}],data:a});t.columns.adjust().draw(),t.fixedHeader.adjust().draw(),$("#count2").text(t.data().count()),$("#edit2Modal").on("shown.bs.modal",function(){$("#edit2Field").focus()}),$("#table2").DataTable().on("dblclick","td",function(){var e=$("#table2").DataTable().row(this),a=$("#table2").DataTable().cell(this);const t=[0,1,2,18];t.includes(a.index().column)||($("#edit2FieldHiddenId").val(e.data().id),$("#edit2FieldHiddenIndex").val(a.index().column),$("#edit2Field").val(a.data()),$("#edit2Modal").modal({keyboard:!1,show:!0}))})})):(firebase.auth().signOut(),window.location.href="login.html")})});